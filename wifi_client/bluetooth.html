<!DOCTYPE html>
<html>

<head>
    <title>Bluetooth BLE Device Communication</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/p5ble@0.0.7/dist/p5.ble.js"></script>
    <link rel="stylesheet" href="bluetooth-style.css">
</head>

<body>
    <div class="wifi-form">
        <div class="info-container">
            <h1>WiFi Setup</h1>
            <p>Enter in your WiFi SSID and Password and then pair with the Arduino board in order to connect it to your
                WiFi and our server.</p>
        </div>
        <input type="text" placeholder="Enter your WiFi SSID" id="SSID">
        <input type="password" placeholder="Enter your WiFi password" id="Password">
        <button id="Submit">Submit</button>
    </div>
    <script>
        let ssid, password
        document.getElementById("Submit").addEventListener("click", function () {
            ssid = document.getElementById("SSID").value;
            password = document.getElementById("Password").value;

            if (password == "" || ssid == "") {
                alert("Please enter your password and ssid");
                return
            }
            setup()
        });

        const serviceUuid = "19b10000-e8f2-537e-4f6c-d104768a1214";

        let myCharacteristic;
        let myValue = 0;
        let myBLE;

        function setup() {
            // Create a p5ble class
            myBLE = new p5ble();
            connectToBle();

        }

        function connectToBle() {
            // Connect to a device by passing the service UUID
            myBLE.connect(serviceUuid, writeValue);
        }

        function writeValue(error, characteristic) {
            if (error) console.log("error: ", error);
            //write the uuid to the characteristics for the board to save or send back
            myBLE.write(characteristic[0], `${ssid};${password};`)
        }

        // A function that will be called once got characteristics
        function gotCharacteristics(error, characteristics) {
            if (error) console.log("error: ", error);
            console.log("characteristics: ", characteristics);
            myCharacteristic = characteristics[0];
            // Read the value of the first characteristic
            myBLE.read(myCharacteristic, gotValue, 'string');
        }

        // A function that will be called once got values
        function gotValue(error, value) {
            if (error) console.log("error: ", error);
            console.log("value: ", value);
            myValue = value;
            // After getting a value, call p5ble.read() again to get the value again
            myBLE.read(myCharacteristic, gotValue);
        }
    </script>


</body>

</html>