<!DOCTYPE html>
<html>

<head>
    <title>Bluetooth BLE Device Communication</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/p5ble@0.0.7/dist/p5.ble.js"></script>
</head>

<body>
    <input type="text" placeholder="Put in Your SSID" id="SSID">
    <input type="password" placeholder="Put in Your Password" id="Password">
    <button id="Submit">Button</button>
    <script>
        let ssid, password
        document.getElementById("Submit").addEventListener("click", function () {
            ssid = document.getElementById("SSID").value;
            password = document.getElementById("Password").value;

            if (password == "" || ssid == "") {
                alert("Please enter your password and ssid");
                return
            }
            setup()
        });

        const serviceUuid = "19b10000-e8f2-537e-4f6c-d104768a1214";

        let myCharacteristic;
        let myValue = 0;
        let myBLE;

        function setup() {
            // Create a p5ble class
            myBLE = new p5ble();
            connectToBle();

        }

        function connectToBle() {
            // Connect to a device by passing the service UUID
            myBLE.connect(serviceUuid, writeValue);
        }

        function writeValue(error, characteristic) {
            if (error) console.log("error: ", error);
            myBLE.write(characteristic[0], `${ssid};${password}`)
        }

        // A function that will be called once got characteristics
        function gotCharacteristics(error, characteristics) {
            if (error) console.log("error: ", error);
            console.log("characteristics: ", characteristics);
            myCharacteristic = characteristics[0];
            // Read the value of the first characteristic
            myBLE.read(myCharacteristic, gotValue);
        }

        // A function that will be called once got values
        function gotValue(error, value) {
            if (error) console.log("error: ", error);
            console.log("value: ", value);
            myValue = value;
            // After getting a value, call p5ble.read() again to get the value again
            myBLE.read(myCharacteristic, gotValue);
        }

        function draw() {
            background(250);
            text(myValue, 100, 100);
        }
    </script>


</body>

</html>